{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="summary-stats">
        <h2>NFL Week 1 2025 - September 5-8</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Games</h3>
                <span class="stat-number">{{ games|length }}</span>
            </div>
            <div class="stat-card">
                <h3>Predictions Made</h3>
                <span class="stat-number">{{ predictions|length }}</span>
            </div>
            <div class="stat-card">
                <h3>This Week</h3>
                <span class="stat-number">Week 1</span>
            </div>
        </div>
    </div>

    <div class="weekly-picks">
        <h2>This Week's Games & Predictions</h2>
        <div class="picks-grid">
            {% for game in games %}
            <div class="game-card" id="game-{{ game.id }}">
                <div class="game-info">
                    <div class="teams">
                        <span class="team away">{{ game.away_team }}</span>
                        <span class="at">@</span>
                        <span class="team home">{{ game.home_team }}</span>
                    </div>
                    <div class="game-time">
                        {{ game.game_date.strftime('%a %m/%d %I:%M %p') }}
                    </div>
                    {% if game.status == 'completed' %}
                    <div class="final-score">
                        Final: {{ game.away_score }} - {{ game.home_score }}
                    </div>
                    {% endif %}
                </div>
                
                {% for prediction in predictions %}
                    {% if prediction.game_id == game.id %}
                    <div class="prediction">
                        <p><strong>AI Pick: {{ prediction.predicted_winner }}</strong></p>
                        <p>Confidence: {{ "%.1f"|format(prediction.confidence * 100) }}%</p>
                        {% if prediction.predicted_spread %}
                        <p>Spread: {{ "%.1f"|format(prediction.predicted_spread) }}</p>
                        {% endif %}
                        {% if prediction.news_sentiment %}
                        <p>News Sentiment: {{ "%.2f"|format(prediction.news_sentiment) }}</p>
                        {% endif %}
                        {% if prediction.reddit_sentiment %}
                        <p>Reddit Sentiment: {{ "%.2f"|format(prediction.reddit_sentiment) }}</p>
                        {% endif %}
                    </div>
                    {% endif %}
                {% endfor %}
                
                <!-- Reddit Picks Section -->
                <div class="reddit-picks" id="reddit-picks-{{ game.id }}">
                    <div class="reddit-loading">
                        <button onclick="loadRedditPicks({{ game.id }})" class="reddit-btn">
                            üìä Get Reddit Picks
                        </button>
                    </div>
                </div>
                
                {% if game.status == 'scheduled' %}
                <button class="predict-btn" onclick="makePrediction({{ game.id }})">Get AI Prediction</button>
                {% endif %}
            </div>
            {% endfor %}
            
            {% if not games %}
            <div class="no-games">
                <h3>No games found</h3>
                <p>Check back later for this week's schedule!</p>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="reddit-summary">
        <h2>Advanced Analysis</h2>
        <div id="reddit-summary-content">
            <button onclick="loadOverallRedditSentiment()" class="reddit-summary-btn">
                üî• Load Reddit Analysis from r/nfl & r/NFLbets
            </button>
            <button class="enhanced-btn" id="enhanced-analysis-btn" onclick="fetchEnhancedAnalysis()">
                üöÄ Get Enhanced Analysis (All APIs)
            </button>
            <button class="auto-populate-btn" id="auto-populate-btn" onclick="autoPopulateRedditPicks()">
                üèà Auto-Populate Comprehensive Analysis
            </button>
        </div>
    </div>

    <div class="weekly-picks">
        <h2>This Week's Picks</h2>
        <div class="picks-grid" id="picks-grid">
            <!-- Predictions will be rendered here automatically by JS -->
        </div>
    </div>
</div>
{% endblock %}